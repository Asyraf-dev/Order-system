<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Checksheet History</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #f4f7fc, #e9f1fa);
      margin: 0;
      padding: 0;
      color: #333;
    }

    h1 {
      text-align: center;
      color: #222;
      font-size: 2.4em;
      margin-top: 20px;
      font-weight: 700;
      letter-spacing: 0.5px;
    }

    .container {
      max-width: 1000px;
      margin: 30px auto;
      padding: 25px;
      background-color: #fff;
      border-radius: 14px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
    }

    .date-label {
      font-size: 1.3em;
      font-weight: 600;
      color: #28a745;
      text-align: center;
      margin: 15px 0 25px 0;
    }

    .history-title {
      font-size: 1.4em;
      color: #444;
      margin-bottom: 20px;
      text-align: center;
      font-weight: 500;
      border-bottom: 2px solid #eee;
      padding-bottom: 10px;
    }

    .card {
      background-color: #fff;
      border-radius: 10px;
      box-shadow: 0 4px 14px rgba(0, 0, 0, 0.08);
      margin-bottom: 25px;
      transition: transform 0.25s ease, box-shadow 0.25s ease;
      overflow: hidden;
    }

    .card:hover {
      transform: translateY(-6px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
    }

    .card-header {
      background: linear-gradient(90deg, #28a745, #219638);
      color: white;
      padding: 15px 20px;
      font-size: 1.3em;
      font-weight: 600;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .today-checklist-label {
      font-size: 0.85em;
      font-weight: bold;
      color: #fff;
      background-color: #ff4e00;
      padding: 4px 10px;
      border-radius: 12px;
      text-transform: uppercase;
      box-shadow: 0 0 6px rgba(255, 78, 0, 0.5);
      animation: minimalBounce 1.5s ease-in-out infinite;
    }

    @keyframes minimalBounce {
      0% { transform: translateY(0); }
      50% { transform: translateY(-3px); }
      100% { transform: translateY(0); }
    }

    .category {
      margin: 18px 20px 10px;
      font-size: 1.15em;
      font-weight: 600;
      color: #333;
      padding: 10px 12px;
      background-color: #f5f9f8;
      border-left: 5px solid #28a745;
      border-radius: 6px;
    }

    .item-list {
      margin: 10px 25px 20px;
      padding-left: 5px;
    }

    .item-list div {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      font-size: 1.05em;
      color: #555;
      border-bottom: 1px solid #eee;
    }

    .item-list div:last-child {
      border-bottom: none;
    }

    .buttons {
      margin-top: 25px;
      text-align: center;
    }

    .buttons button {
      padding: 12px 28px;
      font-size: 1.05em;
      font-weight: 600;
      background: linear-gradient(90deg, #28a745, #219638);
      color: white;
      border: none;
      border-radius: 30px;
      cursor: pointer;
      margin: 8px;
      transition: all 0.25s ease;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.12);
    }

    .buttons button:hover {
      background: linear-gradient(90deg, #219638, #1d8530);
      transform: translateY(-2px);
      box-shadow: 0 6px 14px rgba(0, 0, 0, 0.2);
    }

    .buttons button:focus {
      outline: none;
    }

    /* Mobile responsive design */
    @media screen and (max-width: 768px) {
      h1 {
        font-size: 2em;
      }

      .container {
        width: 92%;
        padding: 18px;
      }

      .card-header {
        font-size: 1.1em;
      }

      .buttons button {
        font-size: 0.95em;
        padding: 10px 20px;
      }
    }

    @media screen and (max-width: 480px) {
      h1 {
        font-size: 1.6em;
      }

      .buttons button {
        font-size: 0.85em;
        padding: 8px 16px;
      }
    }
    .summary-row {
  margin-top: 10px;
  padding: 10px 15px;
  background: linear-gradient(90deg, #e9f9ef, #d8f5e2);
  font-weight: bold;
  text-align: center;
  border-top: 2px solid #28a745;
  border-radius: 0 0 10px 10px;
  font-size: 1.05em;
  letter-spacing: 0.3px;
}

  .highlight {
    background-color: yellow;
    font-weight: bold;
    padding: 0 1px;
    border-radius: 2px;
  }
  .no-result {
    text-align: center;
    font-size: 14px;
    color: #888;
    margin-top: 10px;
  }
  #creditFooter {
  position: fixed;
  bottom: 10px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 0.8em;
  color: #666;
  background: #f9f9f9;
  padding: 5px 12px;
  border-radius: 8px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}
/* ===== Responsive Scaling ===== */

/* Tablets */
@media screen and (max-width: 992px) {
  body {
    font-size: 0.95rem;
  }
  h1 {
    font-size: 2em;
  }
  .container {
    padding: 20px;
  }
  .date-label {
    font-size: 1.1em;
  }
  .history-title {
    font-size: 1.2em;
  }
  .card-header {
    font-size: 1.1em;
    padding: 12px 16px;
  }
  .category {
    font-size: 1em;
    padding: 8px 10px;
  }
  .item-list div {
    font-size: 0.95em;
  }
  .summary-row {
    font-size: 0.95em;
    padding: 8px 12px;
  }
}

/* Phones */
@media screen and (max-width: 768px) {
  body {
    font-size: 0.9rem;
  }
  h1 {
    font-size: 1.7em;
  }
  .container {
    width: 94%;
    padding: 16px;
  }
  .date-label {
    font-size: 1em;
  }
  .history-title {
    font-size: 1.1em;
  }
  .card-header {
    font-size: 1em;
    padding: 10px 14px;
  }
  .category {
    font-size: 0.95em;
    padding: 7px 9px;
  }
  .item-list div {
    font-size: 0.9em;
    padding: 6px 0;
  }
  .buttons button {
    font-size: 0.9em;
    padding: 10px 18px;
    width: 90%; /* stack buttons nicely */
    max-width: 280px;
  }
  .summary-row {
    font-size: 0.9em;
    padding: 7px 10px;
  }
}

/* Small Phones */
@media screen and (max-width: 480px) {
  body {
    font-size: 0.85rem;
  }
  h1 {
    font-size: 1.4em;
  }
  .container {
    width: 96%;
    padding: 12px;
  }
  .date-label {
    font-size: 0.9em;
  }
  .history-title {
    font-size: 1em;
  }
  .card-header {
    font-size: 0.9em;
    padding: 8px 12px;
  }
  .category {
    font-size: 0.9em;
    padding: 6px 8px;
  }
  .item-list div {
    font-size: 0.85em;
  }
  .buttons button {
    font-size: 0.85em;
    padding: 8px 14px;
  }
  .summary-row {
    font-size: 0.85em;
    padding: 6px 8px;
  }
  #creditFooter {
    font-size: 0.7em;
    padding: 4px 8px;
  }
}


  </style>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

</head>
<body>
    <div class="container">
    <h1>üìã Checksheet History</h1>

    <!-- üîπ Credit Text -->
    <div id="creditNote" style="font-size:0.9em; color:#888; font-style:italic; margin:5px 0 15px 0; text-align:center;">
    Developed by <strong>Asyraf Ismail</strong> ‚Äì Continuos Improvement
    </div>

    <!-- Date Label Section -->
    <div id="dateLabel" class="date-label"></div>

    <!-- History Title -->
    <div class="history-title">
      <p>History of Items Selected</p>
    </div>
  <!-- Buttons -->
  <div class="buttons">
    <button class="btn btn-secondary" onclick="window.location.href='inventory.html'">‚Üê Back to Inventory</button>
    <button class="btn btn-primary" onclick="saveToCSV()">‚¨á Save to CSV</button>
  </div>

  <!-- üîç Search bar -->
<input type="text" id="searchHistory" placeholder="Search history..." style="margin-bottom:10px; padding:5px; width:100%;">

  <!-- History Cards -->
  <div id="historyCards"></div>
  </div>

  
<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyC8piEU-44jNKKaiWZlp2mEmDFwbO6FsrY",
    authDomain: "inventory-change-1f2c9.firebaseapp.com",
    databaseURL: "https://inventory-change-1f2c9-default-rtdb.firebaseio.com",
    projectId: "inventory-change-1f2c9",
    storageBucket: "inventory-change-1f2c9.firebasestorage.app",
    messagingSenderId: "657658084944",
    appId: "1:657658084944:web:77898bcda22fcddf275b55",
    measurementId: "G-1BRQB0GFJX"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // Display today's date
  function displayDate() {
    const today = new Date().toLocaleDateString();
    const el = document.getElementById('dateLabel');
    if (el) el.textContent = `Today's Date: ${today}`;
  }

// === 3 GROUP SYSTEM ===

// Keywords for normalization
const categoryKeywords = {
  barang_pasaran: ["kobis","timun","daun","salad","sayur","limau","sayuran","halia","kunyit","lengkuas","serai","rempah","cili","tempe","protein","daging","ayam","bebola"],
  barang_runcit: ["beras","gula","garam","tepung","susu","kopi","teh","sunquick","sirap","nescafe","laici","cincau","ajinomoto","tumix","maggi","kicap","sos","perasa","selalsih"],
  barang_kering: ["sabun","polistrine","plastik","bowl","sudu","garfu","kertas","pen","maker","getah","suun","nonfood","polysti","detergent","saboon"]
};

// Styles/icons for the 3 categories
const categoryStyles = {
  barang_pasaran: { icon: "üõí", color: "#4CAF50", label: "Barang Pasaran" },
  barang_runcit:  { icon: "üè™", color: "#2196F3", label: "Barang Runcit" },
  barang_kering:  { icon: "üì¶", color: "#FF9800", label: "Barang Kering" },
  others:         { icon: "‚ùì", color: "#9E9E9E", label: "Lain-lain" }
};

// Utility: convert HEX to RGBA with alpha
function hexToRgba(hex, alpha = 0.12) {
  if (!hex) return `rgba(0,0,0,${alpha})`;
  const h = hex.replace('#','');
  const bigint = parseInt(h, 16);
  const r = (bigint >> 16) & 255;
  const g = (bigint >> 8) & 255;
  const b = bigint & 255;
  return `rgba(${r}, ${g}, ${b}, ${alpha})`;
}

function cleanInput(raw) {
  return raw
    .toString()
    .toLowerCase()
    // remove emojis
    .replace(/[\u{1F300}-\u{1F6FF}\u{2600}-\u{26FF}]/gu, "")
    // remove punctuation
    .replace(/[^\w\s]/gi, " ")
    .trim();
}

function normalizeCategory(raw) {
  if (!raw) return "others";
  const lowered = cleanInput(raw);

  // ‚úÖ Direct group label mapping
  if (lowered.includes("barang pasar")) return "barang_pasaran";
  if (lowered.includes("barang pasaran")) return "barang_pasaran";
  if (lowered.includes("barang runcit")) return "barang_runcit";
  if (lowered.includes("barang kering")) return "barang_kering";

  // ‚úÖ Keyword matching
  for (const [cat, keywords] of Object.entries(categoryKeywords)) {
    for (const kw of keywords) {
      if (lowered.includes(kw)) {
        console.log(`‚úÖ ${raw} ‚Üí ${cat} (matched: ${kw})`);
        return cat;
      }
    }
  }

  // ‚úÖ Fallbacks
  if (lowered.includes("sayur") || lowered.includes("veget")) {
    console.log(`üîé ${raw} ‚Üí barang_pasaran (fallback)`);
    return "barang_pasaran";
  }
  if (lowered.includes("beras") || lowered.includes("minum") || lowered.includes("drink")) {
    console.log(`üîé ${raw} ‚Üí barang_runcit (fallback)`);
    return "barang_runcit";
  }
  if (lowered.includes("sabun") || lowered.includes("plastik") || lowered.includes("nonfood")) {
    console.log(`üîé ${raw} ‚Üí barang_kering (fallback)`);
    return "barang_kering";
  }

  console.log(`‚ö†Ô∏è ${raw} ‚Üí others (no match after clean)`);
  return "others";
}


// Fetch history (3 groups only)
function fetchHistory() {
  const historyCards = document.getElementById('historyCards');
  if (!historyCards) return;
  const todayDate = new Date().toISOString().split('T')[0];

  db.ref('checklists').once('value', snapshot => {
    const data = snapshot.val();
    historyCards.innerHTML = "";

    if (!data) {
      historyCards.innerHTML = "<p>No historical data available.</p>";
      return;
    }

    const sortedDates = Object.keys(data).sort((a, b) => new Date(b) - new Date(a));

    sortedDates.forEach(date => {
      const card = document.createElement('div');
      card.className = 'card';

      const cardHeader = document.createElement('div');
      cardHeader.className = 'card-header';
      cardHeader.textContent = date;

      if (date === todayDate) {
        const todayLabel = document.createElement('span');
        todayLabel.className = 'today-checklist-label';
        todayLabel.textContent = ' Today Checklist';
        cardHeader.appendChild(todayLabel);
      }
      card.appendChild(cardHeader);

      const items = (data[date].items && Array.isArray(data[date].items)) ? data[date].items : [];
      const groups = {};

      // ‚úÖ Group items into 3 categories only
      items.forEach((it, idx) => {
        let rawCat = (it.category || "").trim();
        let norm = normalizeCategory(rawCat);

        if (!categoryStyles[norm]) {
          console.warn(`‚ö†Ô∏è ${rawCat} ‚Üí others (no match after normalize)`);
          norm = "others";
        }

        if (!groups[norm]) groups[norm] = [];
        groups[norm].push({ ...it, _index: idx });
      });

      const countPerCat = {};
      let totalItems = 0;

      Object.keys(groups).forEach(cat => {
        const arr = groups[cat];
        if (!arr || arr.length === 0) return;

        const style = categoryStyles[cat] || categoryStyles["others"];
        const categoryDiv = document.createElement('div');
        categoryDiv.className = 'category ' + cat;
        categoryDiv.dataset.category = cat;
        categoryDiv.style.backgroundColor = hexToRgba(style.color, 0.09);
        categoryDiv.style.borderLeft = `6px solid ${style.color}`;

        const headerHtml = document.createElement('div');
        headerHtml.className = 'category-header';
        headerHtml.innerHTML = `<span class="icon">${style.icon}</span>
                                <strong>${style.label}</strong>
                                <span class="count" style="float:right; font-size:0.9em; color:${style.color}">
                                  (${arr.length} items)
                                </span>`;
        categoryDiv.appendChild(headerHtml);

        const itemList = document.createElement('div');
        itemList.className = 'item-list';

        // ‚úÖ Render each item
        arr.forEach(itemObj => {
          const realIndex = itemObj._index;
          const itemDiv = document.createElement('div');
          itemDiv.className = "history-item";
          itemDiv.style.display = "flex";
          itemDiv.style.alignItems = "center";
          itemDiv.style.justifyContent = "space-between";
          itemDiv.style.gap = "10px";

          const leftSide = document.createElement('div');
          leftSide.style.display = "flex";
          leftSide.style.alignItems = "center";
          leftSide.style.gap = "8px";

          // ‚úÖ Checkbox
          const checkbox = document.createElement('input');
          checkbox.type = "checkbox";
          checkbox.checked = itemObj.selected === "1";

          // ‚úÖ Label
          const label = document.createElement('span');
          const name = itemObj.item || itemObj.name || "";
          const qty = itemObj.quantity || "";
          const unit = itemObj.unit || "";
          label.textContent = `${name} - ${qty} ${unit}`.trim();

          if (itemObj.selected === "1") {
            label.style.textDecoration = "line-through";
            label.style.color = "#888";
          }

          // ‚úÖ Update Firebase when toggled
          checkbox.addEventListener("change", () => {
            const val = checkbox.checked ? "1" : "0";
            db.ref(`checklists/${date}/items/${realIndex}/selected`).set(val);

            if (checkbox.checked) {
              label.style.textDecoration = "line-through";
              label.style.color = "#888";
            } else {
              label.style.textDecoration = "none";
              label.style.color = "#555";
            }
          });

          leftSide.appendChild(checkbox);
          leftSide.appendChild(label);

          // üóë Remove button
          const removeBtn = document.createElement("button");
          removeBtn.textContent = "‚ùå";
          removeBtn.style.border = "none";
          removeBtn.style.background = "transparent";
          removeBtn.style.cursor = "pointer";
          removeBtn.title = "Remove item";

          removeBtn.onclick = () => {
            if (confirm(`Remove "${name}" from ${date}?`)) {
              db.ref(`checklists/${date}/items/${realIndex}`).remove()
                .then(() => fetchHistory())
                .catch(err => alert("Error removing item: " + err.message));
            }
          };

          itemDiv.appendChild(leftSide);
          itemDiv.appendChild(removeBtn);
          itemList.appendChild(itemDiv);
        });

        categoryDiv.appendChild(itemList);

        totalItems += arr.length;
        countPerCat[cat] = arr.length;

        card.appendChild(categoryDiv);
      });

      // ‚úÖ Summary row (3 groups only)
      const summary = document.createElement('div');
      summary.className = 'summary-row';
      const percent = (c, t) => t > 0 ? ((c / t) * 100).toFixed(1) : 0;

      const order = ["barang_pasaran", "barang_runcit", "barang_kering"];
      const parts = [];
      order.forEach(cat => {
        if (countPerCat[cat]) {
          const sty = categoryStyles[cat] || categoryStyles["others"];
          parts.push(`<span style="color:${sty.color}">${sty.icon} ${sty.label}: ${countPerCat[cat]} (${percent(countPerCat[cat], totalItems)}%)</span>`);
        }
      });

      summary.innerHTML = parts.join(" | ") +
        ` | <strong style="color:#1d8530;">Total: ${totalItems}</strong>`;
      card.appendChild(summary);

      historyCards.appendChild(card);
    });
  });
}


  // üîç Search and Highlight Function
  function searchHistory(query) {
    const cards = document.querySelectorAll("#historyCards .card");
    let foundAny = false;

    cards.forEach(card => {
      let cardHasMatch = false;
      const itemDivs = card.querySelectorAll(".item-list > div"); // each item row

      itemDivs.forEach(itemDiv => {
        const label = itemDiv.querySelector("span");
        if (!label) return;

        const originalText = label.textContent;
        label.innerHTML = originalText; // reset highlight
        itemDiv.style.display = "flex"; // reset

        if (query && originalText.toLowerCase().includes(query.toLowerCase())) {
          cardHasMatch = true;
          foundAny = true;

          // Highlight only the matching text
          const regex = new RegExp(`(${query})`, "gi");
          label.innerHTML = originalText.replace(regex, match => {
            return `<span class="highlight">${match}</span>`;
          });
        } else if (query) {
          // hide non-matching item when searching
          itemDiv.style.display = "none";
        }
      });

      // hide card if no items matched
      card.style.display = cardHasMatch || !query ? "block" : "none";
    });

    // Handle no results
    let noResultDiv = document.getElementById("noResultMsg");
    if (!noResultDiv) {
      noResultDiv = document.createElement("div");
      noResultDiv.id = "noResultMsg";
      noResultDiv.className = "no-result";
      document.getElementById("historyCards").appendChild(noResultDiv);
    }

    if (query && !foundAny) {
      noResultDiv.textContent = "No result found";
      noResultDiv.style.display = "block";
    } else {
      noResultDiv.style.display = "none";
    }
  }

  // üñäÔ∏è Attach to search bar
  document.addEventListener("DOMContentLoaded", () => {
    const searchInput = document.getElementById("searchHistory");
    if (searchInput) {
      searchInput.addEventListener("input", (e) => {
        searchHistory(e.target.value.trim());
      });
    }
  });


   // ‚úÖ Remove emojis
  function removeEmojis(str) {
    if (!str) return "";
    return str.replace(/[\u{1F300}-\u{1FAFF}\u{2600}-\u{26FF}\u{2700}-\u{27BF}]/gu, '').trim();
  }

  // ‚úÖ Escape CSV
  function csvEscape(value) {
    if (value == null) return "";
    value = value.toString().replace(/"/g, '""');
    if (/[",\n]/.test(value)) value = `"${value}"`;
    return value;
  }

  // ‚úÖ Save history to CSV (cleaned + no emoji + includes status)
  function saveToCSV() {
    const historyCards = document.getElementById('historyCards');
    if (!historyCards || !historyCards.children.length) {
      alert('No history data available to export.');
      return;
    }

    const rows = [];
    rows.push([
      'Date',
      'NormalizedCategory',
      'CategoryLabel',
      'Item',
      'Quantity',
      'Unit',
      'Status', // ‚úÖ new column
      'CategoryCount',
      'Category%',
      'TotalItems'
    ].join(','));

    Array.from(historyCards.children).forEach(card => {
      const dateNode = card.querySelector('.card-header');
      const date = dateNode && dateNode.childNodes[0] 
        ? dateNode.childNodes[0].textContent.trim() 
        : '';

      const totalItems = card.querySelectorAll('.item-list div').length;

      card.querySelectorAll('.category').forEach(categoryDiv => {
        const catKey = categoryDiv.dataset.category || 'others';
        const style = categoryStyles[catKey] || categoryStyles["others"];
        const catLabel = removeEmojis(style.label || catKey);

        const itemDivs = categoryDiv.querySelectorAll('.item-list > div');
        const catCount = itemDivs.length;
        const catPercent = totalItems > 0 ? ((catCount / totalItems) * 100).toFixed(1) : 0;

        itemDivs.forEach(itemDiv => {
          const checkbox = itemDiv.querySelector("input[type=checkbox]");
          const labelEl = itemDiv.querySelector("span");

          if (!labelEl) return;
          const rawText = labelEl.textContent; // clean text, no ‚ùå or HTML
          const parts = rawText.split(' - ');

          const itemName = removeEmojis(parts[0] ? parts[0].trim() : "");
          let quantity = "", unit = "";
          if (parts[1]) {
            const m = parts[1].trim().match(/(\d+)\s*(.*)/);
            if (m) {
              quantity = m[1];
              unit = removeEmojis(m[2] || "");
            } else {
              quantity = removeEmojis(parts[1].trim());
            }
          }

          const status = checkbox && checkbox.checked ? "done" : "pending"; // ‚úÖ new

          const row = [
            csvEscape(date),
            csvEscape(catKey),
            csvEscape(catLabel),
            csvEscape(itemName),
            csvEscape(quantity),
            csvEscape(unit),
            csvEscape(status),
            csvEscape(catCount),
            csvEscape(catPercent),
            csvEscape(totalItems)
          ].join(',');
          rows.push(row);
        });
      });
    });

    const csvString = rows.join('\n');
    const blob = new Blob([csvString], { type: 'text/csv;charset=utf-8;' });
    const url = URL.createObjectURL(blob);

    const link = document.createElement('a');
    link.setAttribute('href', url);
    link.setAttribute('download', 'checksheet_history.csv');
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  }

  // Normalize Firebase categories
  async function normalizeFirebaseCategories() {
    if (!confirm("This will update category fields in your Firebase checklists to normalized values. BACKUP first. Continue?")) return;
    const snapshot = await db.ref('checklists').once('value');
    const data = snapshot.val();
    if (!data) { alert("No checklists found."); return; }

    const updates = {};
    Object.keys(data).forEach(dateKey => {
      const items = data[dateKey].items || [];
      items.forEach((it, idx) => {
        const oldCat = it.category || "";
        const newCat = normalizeCategory(oldCat);
        if ((oldCat || "").toString().trim().toLowerCase() !== newCat) {
          updates[`/checklists/${dateKey}/items/${idx}/category`] = newCat;
        }
      });
    });

    if (Object.keys(updates).length === 0) {
      alert("No category changes detected (already normalized).");
      return;
    }

    try {
      await db.ref().update(updates);
      alert("Firebase categories normalized successfully.");
      fetchHistory();
    } catch (err) {
      console.error(err);
      alert("Error updating Firebase: " + err.message);
    }
  }

  window.saveToCSV = saveToCSV;
  window.normalizeFirebaseCategories = normalizeFirebaseCategories;

  window.onload = function() {
    displayDate();
    fetchHistory();
  };
</script>

</script>

</body>
</html>
